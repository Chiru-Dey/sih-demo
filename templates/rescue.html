{% extends "base.html" %}

{% block title %}Rescue Services - Disastrous{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1><i class="fas fa-ambulance"></i> Rescue Services</h1>
        <p>Emergency rescue coordination and assistance</p>
    </div>

    <button type="button" class="collapsible active">Local</button>
    <div class="content">
        <p>No local rescue operations at the moment.</p>
    </div>

    <button type="button" class="collapsible">General</button>
    <div class="content">
        <!-- Emergency Contacts -->
        <div class="emergency-contacts-section">
            <h2><i class="fas fa-phone-alt"></i> Emergency Contacts</h2>
            <div class="contacts-grid">
                <div class="contact-card urgent">
                    <div class="contact-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="contact-info">
                        <h3>Emergency Helpline</h3>
                        <p class="contact-number">112</p>
                        <p class="contact-desc">All Emergency Services</p>
                    </div>
                    <button class="btn-primary" onclick="callEmergency('112')">
                        <i class="fas fa-phone"></i> Call Now
                    </button>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-fire-extinguisher"></i>
                    </div>
                    <div class="contact-info">
                        <h3>Fire Department</h3>
                        <p class="contact-number">101</p>
                        <p class="contact-desc">Fire & Rescue Services</p>
                    </div>
                    <button class="btn-primary" onclick="callEmergency('101')">
                        <i class="fas fa-phone"></i> Call
                    </button>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="contact-info">
                        <h3>Police</h3>
                        <p class="contact-number">100</p>
                        <p class="contact-desc">Law Enforcement</p>
                    </div>
                    <button class="btn-primary" onclick="callEmergency('100')">
                        <i class="fas fa-phone"></i> Call
                    </button>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="contact-info">
                        <h3>Medical Emergency</h3>
                        <p class="contact-number">108</p>
                        <p class="contact-desc">Ambulance Service</p>
                    </div>
                    <button class="btn-primary" onclick="callEmergency('108')">
                        <i class="fas fa-phone"></i> Call
                    </button>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="contact-info">
                        <h3>Disaster Management</h3>
                        <p class="contact-number">1078</p>
                        <p class="contact-desc">NDRF Helpline</p>
                    </div>
                    <button class="btn-primary" onclick="callEmergency('1078')">
                        <i class="fas fa-phone"></i> Call
                    </button>
                </div>

                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-child"></i>
                    </div>
                    <div class="contact-info">
                        <h3>Child Helpline</h3>
                        <p class="contact-number">1098</p>
                        <p class="contact-desc">Child Protection</p>
                    </div>
                    <button class="btn-primary" onclick="callEmergency('1098')">
                        <i class="fas fa-phone"></i> Call
                    </button>
                </div>
            </div>
        </div>

        <div class="form-container">
            <h2><i class="fas fa-sos"></i> Request Rescue</h2>
            <form id="rescue-request-form">
                <div class="form-group">
                    <label for="emergency-type">Emergency Type</label>
                    <select id="emergency-type" class="form-control" required>
                        <option value="">Select Emergency Type</option>
                        <option value="flood">Flood/Water Rescue</option>
                        <option value="fire">Fire Emergency</option>
                        <option value="collapse">Building Collapse</option>
                        <option value="landslide">Landslide</option>
                        <option value="medical">Medical Emergency</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="victim-count">Number of People Affected</label>
                    <input type="number" id="victim-count" class="form-control" min="1" placeholder="e.g., 5">
                </div>

                <div class="form-group">
                    <label for="street-address">Street Address/Building</label>
                    <input type="text" id="street-address" class="form-control" placeholder="Enter street address or building name">
                </div>

                <div class="form-group">
                    <label for="area-locality">Area/Locality</label>
                    <input type="text" id="area-locality" class="form-control" placeholder="Enter area or locality">
                </div>

                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" class="form-control" placeholder="Enter city name">
                </div>

                <div class="form-group">
                    <label for="state">State</label>
                    <select id="state" class="form-control">
                        <option value="">Select State</option>
                        <option value="AN">Andaman and Nicobar Islands</option>
                        <option value="AP">Andhra Pradesh</option>
                        <option value="AR">Arunachal Pradesh</option>
                        <option value="AS">Assam</option>
                        <option value="BR">Bihar</option>
                        <option value="CH">Chandigarh</option>
                        <option value="CT">Chhattisgarh</option>
                        <option value="DN">Dadra and Nagar Haveli</option>
                        <option value="DD">Daman and Diu</option>
                        <option value="DL">Delhi</option>
                        <option value="GA">Goa</option>
                        <option value="GJ">Gujarat</option>
                        <option value="HR">Haryana</option>
                        <option value="HP">Himachal Pradesh</option>
                        <option value="JK">Jammu and Kashmir</option>
                        <option value="JH">Jharkhand</option>
                        <option value="KA">Karnataka</option>
                        <option value="KL">Kerala</option>
                        <option value="LA">Ladakh</option>
                        <option value="LD">Lakshadweep</option>
                        <option value="MP">Madhya Pradesh</option>
                        <option value="MH">Maharashtra</option>
                        <option value="MN">Manipur</option>
                        <option value="ML">Meghalaya</option>
                        <option value="MZ">Mizoram</option>
                        <option value="NL">Nagaland</option>
                        <option value="OR">Odisha</option>
                        <option value="PY">Puducherry</option>
                        <option value="PB">Punjab</option>
                        <option value="RJ">Rajasthan</option>
                        <option value="SK">Sikkim</option>
                        <option value="TN">Tamil Nadu</option>
                        <option value="TG">Telangana</option>
                        <option value="TR">Tripura</option>
                        <option value="UP">Uttar Pradesh</option>
                        <option value="UT">Uttarakhand</option>
                        <option value="WB">West Bengal</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="pincode">PIN Code</label>
                    <input type="text" id="pincode" class="form-control" pattern="[0-9]{6}" maxlength="6" placeholder="Enter 6-digit PIN code">
                </div>

                <div class="form-group">
                    <label for="contact-person">Your Contact Number</label>
                    <input type="tel" id="contact-person" class="form-control" placeholder="+91 XXXXXXXXXX">
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-paper-plane"></i> Submit Request
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    function callEmergency(number) {
        if (confirm(`Calling emergency number ${number}. Are you sure?`)) {
            window.location.href = `tel:${number}`;
        }
    }

    document.getElementById('rescue-request-form').addEventListener('submit', function (e) {
        e.preventDefault();
        submitRescueRequest();
    });

    async function submitRescueRequest() {
        const emergencyType = document.getElementById('emergency-type').value;
        const victimCount = document.getElementById('victim-count').value;
        const streetAddress = document.getElementById('street-address').value;
        const areaLocality = document.getElementById('area-locality').value;
        const city = document.getElementById('city').value;
        const state = document.getElementById('state').value;
        const pincode = document.getElementById('pincode').value;
        const contact = document.getElementById('contact-person').value;

        // Only emergency type and contact are required
        if (!emergencyType || !contact) {
            showNotification('Please fill in all required fields.', 'warning');
            return;
        }

        // Validate PIN code format if provided
        if (pincode && !pincode.match(/^[0-9]{6}$/)) {
            showNotification('Please enter a valid 6-digit PIN code.', 'warning');
            return;
        }

        try {
            const response = await fetch('/rescue', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    emergency_type: emergencyType,
                    victim_count: victimCount,
                    street_address: streetAddress,
                    area_locality: areaLocality,
                    city: city,
                    state: state,
                    pincode: pincode,
                    contact: contact
                })
            });

            const data = await response.json();
            
            if (response.ok) {
                showNotification('Emergency request submitted successfully!', 'success');
                document.getElementById('rescue-request-form').reset();
            } else {
                showNotification(data.message || 'Failed to submit request. Please try again.', 'error');
            }
        } catch (error) {
            console.error('Error submitting rescue request:', error);
            showNotification('Failed to submit request. Please try again.', 'error');
        }
    }
</script>
{% endblock %}